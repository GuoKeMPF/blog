<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        const object = {
            num: 11111,
            str: 'string',
            arr: [1, 2, 3],
            undif: undefined,
            boolean: true,
            reg: /asdf/,
            a: 'AA',
            fun: function () {
                console.log('function');
            },
            obj: {
                a: 'aa',
                b: 'bb',
                c: {
                    d: 'dd'
                }
            },
        };
        object.obj.self = object.obj;

        const ifObject = data => data === null || !(typeof data === 'object');

        console.log(object);
        // const jsonCopy = obj => JSON.parse(JSON.stringify(obj));
        // const jsonObj = jsonCopy(object);
        // console.log(jsonObj);

        // const deepCopy = (data) => {
        //     let dataTmp = undefined
        //     if (data === null || !(typeof data === 'object')) {
        //         dataTmp = data
        //     } else {
        //         dataTmp = data.constructor.name === 'Array' ? [] : {}
        //         for (let key in data) {
        //             dataTmp[key] = deepCopy(data[key])
        //         }
        //     }
        //     return dataTmp
        // }
        // const copyObj = deepCopy(object)
        // console.log(copyObj);


        const deepWeakMapCopy = (data, hash = new WeakMap()) => {
            if (ifObject(data)) {
                return data
            }

            if (hash.has(data)) {
                return hash.get(data)
            }

            const target = Array.isArray(data) ? [] : {};

            hash.set(data, target)

            for (const key in data) {
                if (Object.hasOwnProperty.call(data, key)) {
                    const element = data[key];
                    if (ifObject(element)) {
                        target[key] = deepWeakMapCopy(element, hash)
                    } else {
                        target[key] = data[key]
                    }
                }
            }
            return target;
        }

        const weakMapCopy = deepWeakMapCopy(object);
        console.log(weakMapCopy);


    </script>
</body>

</html>